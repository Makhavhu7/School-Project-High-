<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduHub - Admin Login</title>
    <meta name="description" content="Enter your credentials to access the admin dashboard" />
    <meta name="author" content="EduHub" />
    <meta property="og:title" content="EduHub - Admin Login" />
    <meta property="og:description" content="Enter your credentials to access the admin dashboard" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@eduhub" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <script src="https://cdn.tailwindcss.com"></script> <!-- Replace with compiled CSS for production -->
    <!-- Firebase SDK CDN with module type -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <style>
      :root {
        --background: 0 0% 100%;
        --foreground: 222 84% 4.9%;
        --card: 0 0% 100%;
        --card-foreground: 222 84% 4.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 222 84% 4.9%;
        --primary: 210 100% 60%; /* Blue shade */
        --primary-foreground: 0 0% 100%;
        --primary-glow: 210 100% 70%;
        --secondary: 210 40% 96%;
        --secondary-foreground: 222 47% 11%;
        --muted: 210 40% 96%;
        --muted-foreground: 215 16% 47%;
        --accent: 195 100% 85%;
        --accent-foreground: 222 84% 4.9%;
        --accent-glow: 195 100% 90%;
        --destructive: 0 84% 60%;
        --destructive-foreground: 0 0% 98%;
        --border: 214 32% 91%;
        --input: 214 32% 91%;
        --ring: 210 100% 60%;
        --gradient-primary: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary-glow)));
        --gradient-accent: linear-gradient(135deg, hsl(var(--accent)), hsl(var(--accent-glow)));
        --gradient-hero: linear-gradient(135deg, hsl(0 0% 96%), hsl(210 40% 98%));
        --shadow-glow: 0 0 30px hsl(var(--primary) / 0.2);
        --shadow-accent-glow: 0 0 20px hsl(var(--accent) / 0.3);
        --radius: 0.75rem;
        --sidebar-background: 0 0% 98%;
        --sidebar-foreground: 240 5.3% 26.1%;
        --sidebar-primary: 240 5.9% 10%;
        --sidebar-primary-foreground: 0 0% 98%;
        --sidebar-accent: 240 4.8% 95.9%;
        --sidebar-accent-foreground: 240 5.9% 10%;
        --sidebar-border: 220 13% 91%;
        --sidebar-ring: 217.2 91.2% 59.8%;
      }

      .dark {
        --background: 222 84% 4.9%;
        --foreground: 210 40% 98%;
        --card: 222 84% 4.9%;
        --card-foreground: 210 40% 98%;
        --popover: 222 84% 4.9%;
        --popover-foreground: 210 40% 98%;
        --primary: 210 100% 60%;
        --primary-foreground: 0 0% 100%;
        --primary-glow: 210 100% 70%;
        --secondary: 217 33% 17%;
        --secondary-foreground: 210 40% 98%;
        --muted: 217 33% 17%;
        --muted-foreground: 215 16% 65%;
        --accent: 195 100% 85%;
        --accent-foreground: 222 84% 4.9%;
        --accent-glow: 195 100% 90%;
        --destructive: 0 63% 31%;
        --destructive-foreground: 210 40% 98%;
        --border: 217 33% 17%;
        --input: 217 33% 17%;
        --ring: 210 100% 60%;
        --sidebar-background: 240 5.9% 10%;
        --sidebar-foreground: 240 4.8% 95.9%;
        --sidebar-primary: 224.3 76.3% 48%;
        --sidebar-primary-foreground: 0 0% 100%;
        --sidebar-accent: 240 3.7% 15.9%;
        --sidebar-accent-foreground: 240 4.8% 95.9%;
        --sidebar-border: 240 3.7% 15.9%;
        --sidebar-ring: 217.2 91.2% 59.8%;
      }

      * {
        border-color: hsl(var(--border));
      }

      body {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
      }

      .btn-admin {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        box-shadow: 0 4px 6px rgba(56, 189, 248, 0.3); /* Blue shadow */
        transition: all 0.3s ease;
      }

      .btn-admin:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(56, 189, 248, 0.4);
      }
    </style>
  </head>
  <body>
    <div class="min-h-screen bg-[var(--gradient-hero)]">
      <!-- Navigation -->
      <nav class="bg-[hsl(var(--card)/0.8)] border-b border-[hsl(var(--border)/0.5)] backdrop-blur-sm fixed w-full top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
          <a href="/" class="text-2xl font-bold bg-[var(--gradient-primary)] bg-clip-text">EduHub</a>
          <div class="space-x-4">
            <a href="materials.html" class="text-[hsl(var(--foreground))] hover:text-[hsl(var(--primary))]">Materials</a>
            <a href="admin-login.html" class="btn-admin py-2 px-4 rounded-[var(--radius)]">Admin Login</a>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <div class="pt-20 pb-12 px-4 flex items-center justify-center">
        <div class="w-full max-w-md bg-[hsl(var(--card)/0.8)] backdrop-blur-md border border-[hsl(var(--border)/0.5)] rounded-[var(--radius)] shadow-[var(--shadow-glow)] p-6">
          <!-- Logo -->
          <div class="flex justify-center mb-6">
            <svg class="h-16 w-16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path fill="#38BDF8" d="M12 2L3 7v10l9 5 9-5V7l-9-5z" /> <!-- Blue shield base -->
              <path fill="#FFFFFF" d="M12 7v10l4-2.5V9.5L12 7z" /> <!-- White section -->
              <path stroke="#38BDF8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 2L3 7v10l9 5 9-5V7l-9-5z" />
            </svg>
          </div>
          <!-- Login Header -->
          <div class="text-center">
            <h1 class="text-2xl font-bold mb-2">
              <span class="bg-[var(--gradient-primary)] bg-clip-text">Admin Login</span>
            </h1>
            <p class="text-[hsl(var(--muted-foreground))]">Click below to receive a sign-in link</p>
          </div>
          <!-- Login Form -->
          <div class="mt-6">
            <form id="login-form" class="space-y-4">
              <div class="space-y-2">
                <label for="email" class="block text-sm font-medium">Email</label>
                <input id="email" type="email" value="mbofhenijunior7@gmail.com" placeholder="Enter your email" required class="w-full py-2 px-3 border border-[hsl(var(--input))] rounded-[var(--radius)] bg-[hsl(var(--background))] text-[hsl(var(--foreground))]" readonly />
              </div>
              <button type="submit" id="submit-button" class="w-full bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] py-2 rounded-[var(--radius)] shadow-[var(--shadow-glow)] font-semibold hover:shadow-[0 6px 8px rgba(56, 189, 248, 0.4)] hover:translate-y-[-2px] transition-all duration-300">
                <span class="bg-[var(--gradient-primary)] bg-clip-text text-transparent">EduHub</span> Send Sign-In Link
              </button>
            </form>
            <div class="mt-6 p-4 bg-[hsl(var(--muted)/0.2)] rounded-[var(--radius)]">
              <p class="text-sm text-[hsl(var(--muted-foreground))] text-center">
                Hello Admin<br />
                I Hope You Are Good<br />
                Have a Great Day
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="bg-[hsl(var(--card)/0.3)] py-8 px-4 border-t border-[hsl(var(--border))]">
        <div class="container mx-auto text-center">
          <p class="text-[hsl(var(--muted-foreground))] mb-4">Â© 2025 EduHub. Empowering students through quality education.</p>
          <div class="flex justify-center space-x-4">
            <a href="/materials.html" class="text-[hsl(var(--muted-foreground))] hover:text-[hsl(var(--primary))]">Materials</a>
            <a href="/admin-login.html" class="text-[hsl(var(--muted-foreground))] hover:text-[hsl(var(--primary))]">Admin Login</a>
            <a href="#" class="text-[hsl(var(--muted-foreground))] hover:text-[hsl(var(--primary))]">Contact Us</a>
          </div>
        </div>
      </footer>
    </div>

    <script type="module">
      // Secure Firebase Configuration (Move to environment variables in production)
      const firebaseConfig = {
        apiKey: "AIzaSyDZjmRfYDPW1EC58Wj0l9yxjoE6rgqhqc8",
        authDomain: "school-app-39092.firebaseapp.com",
        projectId: "school-app-39092",
        storageBucket: "school-app-39092.firebasestorage.app",
        messagingSenderId: "1043664358438",
        appId: "1:1043664358438:web:a91aab2d53a541368a2ae7",
        measurementId: "G-ENPLJLLP1M"
      };

      // Initialize Firebase
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
      import { getAuth, sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // Configure Firebase to use email link authentication
      const actionCodeSettings = {
        url: 'https://makhschooleasy.netlify.app/admin-dashboard.html', // Production URL
        handleCodeInApp: true,
        dynamicLinkDomain: 'schoolapp39092.page.link' // Replace with your Firebase Dynamic Links domain
      };

      function showToast(title, description, variant = 'default') {
        const toast = document.createElement('div');
        toast.className = `fixed bottom-4 right-4 p-4 rounded-[${getComputedStyle(document.documentElement).getPropertyValue('--radius').trim()}] shadow-[${getComputedStyle(document.documentElement).getPropertyValue('--shadow-glow').trim()}] z-50 ${
          variant === 'destructive' ? 'bg-[hsl(var(--destructive))] text-[hsl(var(--destructive-foreground))]' : 'bg-[hsl(var(--card))] text-[hsl(var(--foreground))]'
        }`;
        toast.innerHTML = `<h3 class="font-bold">${title}</h3><p>${description}</p>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 5000); // Increased duration for better visibility
      }

      document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const emailInput = document.getElementById('email');
        const email = emailInput.value;
        const submitButton = document.getElementById('submit-button');
        submitButton.textContent = 'Sending Link...';
        submitButton.disabled = true;

        // Restrict to mbofhenijunior7@gmail.com
        if (email !== 'mbofhenijunior7@gmail.com') {
          showToast('Access Denied', 'Only mbofhenijunior7@gmail.com is authorized to log in.', 'destructive');
          submitButton.textContent = '<span class="bg-[var(--gradient-primary)] bg-clip-text text-transparent">EduHub</span> Send Sign-In Link';
          submitButton.disabled = false;
          return;
        }

        // Send sign-in link
        sendSignInLinkToEmail(auth, email, actionCodeSettings)
          .then(() => {
            window.localStorage.setItem('emailForSignIn', email);
            showToast('Success', 'A sign-in link has been sent to ' + email + '. Open it on this device to access the dashboard.', 'default');
            submitButton.textContent = '<span class="bg-[var(--gradient-primary)] bg-clip-text text-transparent">EduHub</span> Send Sign-In Link';
            submitButton.disabled = false;
          })
          .catch((error) => {
            console.error('Send Sign-In Link Error:', error);
            showToast('Error', error.message || 'Failed to send sign-in link. Ensure the domain is authorized and Dynamic Links are configured in Firebase Console.', 'destructive');
            submitButton.textContent = '<span class="bg-[var(--gradient-primary)] bg-clip-text text-transparent">EduHub</span> Send Sign-In Link';
            submitButton.disabled = false;
          });
      });

      // Handle the email link when the user clicks it
      if (isSignInWithEmailLink(auth, window.location.href)) {
        const email = window.localStorage.getItem('emailForSignIn');
        if (!email) {
          showToast('Error', 'Please open the link on the same device and browser where you requested it, or request a new link.', 'destructive');
          return;
        }
        signInWithEmailLink(auth, email, window.location.href)
          .then((result) => {
            window.localStorage.removeItem('emailForSignIn');
            if (result.user.email !== 'mbofhenijunior7@gmail.com') {
              signOut(auth).then(() => {
                showToast('Access Denied', 'Unauthorized email detected.', 'destructive');
              });
              return;
            }
            showToast('Login Successful', 'Redirecting to the admin dashboard!', 'default');
            window.location.replace('/admin-dashboard.html'); // Use replace to avoid back-button issues
          })
          .catch((error) => {
            console.error('Sign-In Link Error:', error);
            let errorMessage = error.message;
            if (error.code === 'auth/invalid-action-code') {
              errorMessage = 'The sign-in link is invalid or expired. Please request a new link.';
            }
            showToast('Login Failed', errorMessage, 'destructive');
          });
      }

      // Make email input read-only on page load
      document.addEventListener('DOMContentLoaded', () => {
        const emailInput = document.getElementById('email');
        emailInput.readOnly = true;
        emailInput.value = 'mbofhenijunior7@gmail.com';
      });
    </script>
  </body>
</html>